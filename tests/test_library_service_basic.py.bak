import pytest
from services.library_service import (
    get_catalog,
    get_borrowed_books,
    get_patron_borrowed_books,
    add_book_to_catalog,
    borrow_book_by_patron,
    return_book_by_patron
)

def test_get_catalog():
    catalog = get_catalog()
    assert isinstance(catalog, dict)  # 保持和实现一致

def test_get_borrowed_books():
    borrowed = get_borrowed_books()
    assert isinstance(borrowed, dict)  # 实际返回 dict

def test_get_patron_borrowed_books():
    borrowed = get_patron_borrowed_books('patron1')
    assert isinstance(borrowed, list)

def test_add_book_to_catalog():
    result = add_book_to_catalog('b100', 'Test Book', 'Author A', 'ISBN123')
    assert result is True

def test_borrow_and_return():
    add_book_to_catalog('b101', 'Borrow Test', 'Author B', 'ISBN456')
    borrow_book_by_patron('b101', 'patron1')
    borrowed = get_patron_borrowed_books('patron1')
    assert 'b101' in [b['id'] for b in borrowed]
    return_book_by_patron('b101', 'patron1')
    borrowed_after = get_patron_borrowed_books('patron1')
    assert 'b101' not in [b['id'] for b in borrowed_after]
