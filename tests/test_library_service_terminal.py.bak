from services.library_service import (
    reset_globals,
    add_book_to_catalog,
    borrow_book_by_patron,
    get_patron_borrowed_books
)

def test_add_and_borrow_terminal():
    reset_globals()  # 清空全局状态，干净开始
    # 使用合法 10 位 ISBN
    book_id = 'b_terminal'
    title = 'Terminal Test Book'
    author = 'Author Terminal'
    isbn = '0123456789'  # 10 位合法 ISBN
    result = add_book_to_catalog(book_id, title, author, isbn)
    print("add_book result:", result)
    assert result is True
    # 借书测试
    patron_id = 'patron_terminal'
    borrow_book_by_patron(book_id, patron_id)
    borrowed = get_patron_borrowed_books(patron_id)
    print("borrowed books:", borrowed)
    assert any(b['id'] == book_id for b in borrowed)
